# azf-statistics
Azure function for handling stats

# Usage
## POST /Stats
Creates a statistics document in {system}-collection in statistics database

See the example below for required fields. You can add as many optional fields as you like in addition to the required fields.

Example payload
```js
{
  "system": "Acos", // Required. System name. New system creates a new collection
  "engine": "azf-acos-interact v1", // Required. e.g. from package json 
  "county": "VTFK", // Optional. If missing autogenerated from DEFAULT_COUNTY environment variable
  "company": "SMM", // Required. Sector
  "department": "Graveteam", // Optional. If missing, company will be set here.
  "description": "Arkivering av gravesøknad og opprettelse av et listeelement i SP. Oppdaterer også kontaktobjektet i 360", // Required. A description of what the statistic element represents
  "projectId": "Prosjekt ID (Hvis det er en kobling til innovasjonsløypa)", // Optional. If not set, will be set to "ingen prosjekttilknytning"
  "type": "SMM - Gravesoknad", // Required. A short searchable type-name that distinguishes the statistic element
  "externalId": "refId fra Acos", // Optional. ID in the external {system}
  // optional fields:
  "optionalField": "23/45678-3", // Optional. anything you like
  "optionalField2": 4567895, // Optional. anything you like
  ...
  "anotherLastOptionalkField": true, // Optional. anything you like
}
```

# Development

- Clone the repo
- Make sure you have azure function core tools installed

```bash
npm i
```

- Create a local.settings.json file
```json
{
  "IsEncrypted": false,
  "Values": {
    "FUNCTIONS_WORKER_RUNTIME": "node",
    "AzureWebJobsStorage": "UseDevelopmentStorage=true",
    "MONGO_DB_E18_CONNECTION_STRING_READ": "connectionstring",
    "MONGO_DB_E18_DATABASE": "E18 db name",
    "MONGO_DB_E18_STATISTICS_COLLECTION": "e18 statistics collection name",
    "MONGO_STATISTICS_CONNECTION_STRING": "connectionstring",
    "MONGO_DB_STATISTICS_DATABASE": "statistics db name",
    "AZURE_BLOB_CONNECTIONSTRING": "connection string",
    "AZURE_BLOB_CONTAINERNAME": "container name",
    "DEFAULT_COUNTY": "county name"
  }
}
```

### Test the function
```bash
func start
```
